<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Familjens Dashboard â€“ Omdesign</title>
  <!-- Typsnitt -->
  <link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@400;700&family=Playfair+Display&family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

<style>
/* ------------------ Globalt tema ------------------ */
body {
  margin: 0;
  font-family: 'Helvetica Neue', Arial, sans-serif;
  background: linear-gradient(to bottom right, #f9f9f9, #e6e6e6);
  color: #222;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}

/* ------------------ Meny ------------------ */
.menu {
  display: flex;
  justify-content: space-around;
  width: 100%;
  background: dimgrey;
  padding: 10px 0;
  position: fixed;
  top: 0;
  left: 0;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  z-index: 1200;
}
.tab-button {
  background: none;
  border: none;
  font-weight: bold;
  padding: 10px 20px;
  border-radius: 999px;
  cursor: pointer;
  transition: background 0.3s, transform 0.2s;
  color: white;
}
.tab-button.active { background: cyan; color: #111; }
.tab-button:hover  { transform: translateY(-2px); }

/* ------------------ Fasta Statusbar ------------------ */
.top-status-bar {
  position: fixed;
  top: 60px;
  left: 0;
  width: 100%;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  padding: 10px 20px;
  display: flex;
  justify-content: space-between;
  z-index: 1150;
}
.tsb-left, .tsb-center, .tsb-right {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}
.clock-date {
  display: flex;
  flex-direction: column;
  align-items: center;
}
.big-time   { font-size: 1.8rem; font-weight: 600; }
.small-date { font-size: 0.95rem; color: #666; }

.weather-now      { display: flex; flex-direction: column; align-items: center; gap: 4px; }
.weather-now i    { font-size: 1.8rem; color: #333; }
#current-temp     { font-size: 1.3rem; font-weight: 600; }
#weather-desc     { font-size: 0.95rem; color: #666; }

.forecast-others         { display: flex; gap: 8px; justify-content: center; }
.forecast-others .day    { text-align: center; background: rgba(255,255,255,.6); padding: 4px; border-radius: 8px; font-size: 0.8rem; color: #444; }
.forecast-others .day i  { font-size: 1.2rem; margin: 2px 0; }

/* ------------------ HuvudinnehÃ¥ll ------------------ */
.container {
  margin-top: 130px;
  background: #fff;
  backdrop-filter: blur(8px);
  padding: 30px;
  border-radius: 20px;
  width: 90%;
  max-width: 1100px;
  box-shadow: 0 4px 12px rgba(0,0,0,.1);
}
.tab-content        { display:none; animation:fadeIn .5s forwards; width:100%; }
.tab-content.active { display:block; }
@keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

/* ------------------ Widgetar ------------------ */
.widget {
  background: #fff;
  border-radius: 16px;
  padding: 20px;
  margin: 20px 0;
  box-shadow: 0 4px 12px rgba(0,0,0,.1);
}
.calendar-iframe {
  width: 100%;
  height: 600px;
  border: none;
  border-radius: 15px;
  box-shadow: 0 0 15px rgba(0,0,0,.1);
}

/* ------------------ Nyhetsbanner ------------------ */
.news-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: rgba(0,0,0,.6);
  color: #fff;
  padding: 12px;
  font-weight: bold;
  z-index: 1100;
  white-space: nowrap;
  overflow: hidden;
}
.news-content {
  display: inline-block;
  padding-left: 100%;
  animation: scrollLeft 70s linear infinite;
}
@keyframes scrollLeft { from{transform:translateX(0);} to{transform:translateX(-100%);} }

/* ------------------ ToDo ------------------ */
#todo .widget          { border-left:none!important; padding:0; }
.todo-card             { background:#fdfdfd; border-radius:15px; padding:15px; margin:10px; box-shadow:0 2px 6px rgba(0,0,0,.1); font-family:'Poppins',sans-serif; }
#todo-list             { list-style:none; padding:0; margin:0; }
#todo-list li          { display:flex; align-items:center; justify-content:space-between; padding:8px 12px; border-bottom:1px dashed #ddd; transition:background .2s; }
#todo-list li:last-child { border-bottom:none; }
#todo-list li:hover    { background:rgba(0,0,0,.02); }
.todo-input            { border:none; border-top:1px solid #ddd; padding:12px; width:100%; box-sizing:border-box; font-size:1rem; border-bottom-left-radius:15px; border-bottom-right-radius:15px; }
.todo-checkbox {
  width:20px; height:20px; margin-right:12px; cursor:pointer; -webkit-appearance:none; appearance:none;
  border:2px solid #ddd; border-radius:4px; position:relative; transition:background .2s,border-color .2s;
}
.todo-checkbox:checked          { background:#4caf50; border-color:#4caf50; }
.todo-checkbox:checked::after   { content:"âœ“"; color:#fff; position:absolute; top:0; left:3px; font-size:14px; line-height:20px; }

/* ------------------ Agenda ------------------ */
.agenda-grid   { display:grid; grid-template-columns:repeat(3,1fr); gap:20px; overflow:visible; }
.agenda-column { flex:1; min-width:22%; margin:0 5px; padding:15px; border-radius:16px; backdrop-filter:blur(12px); transition:transform .3s ease; }
.agenda-column:hover   { transform:translateY(-5px); }
.agenda-column h3      { text-align:center; margin-bottom:10px; font-family:'Playfair Display',serif; font-weight:bold; border-bottom:1px solid rgba(255,255,255,.2); padding-bottom:8px; }
.event                 { margin-bottom:14px; padding:12px 15px; background:rgba(255,255,255,.08); border:none; box-shadow:0 1px 0 rgba(0,0,0,.1); border-radius:12px; }
.popup                 { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:grey; color:cyan; padding:1.5rem; border-radius:1rem; box-shadow:0 0 20px rgba(0,0,0,.2); display:none; z-index:2000; max-width:90%; }
.popup.active          { display:block; }
.popup-close           { background:none; color:white; border:none; font-size:1.6rem; cursor:pointer; }

/* ------------------ Dark Mode ------------------ */
body.dark-mode {
  background:linear-gradient(to bottom right,#2c2c2c,#1c1c1c);
  color:#f0f0f0;
}
body.dark-mode .container,
body.dark-mode .widget,
body.dark-mode .card,
body.dark-mode .group,
body.dark-mode .group-header,
body.dark-mode .group-content { background:rgba(40,40,40,.8)!important; color:#f0f0f0!important; }
body.dark-mode .group-header { background:rgba(60,60,60,.8)!important; }

/* ------------------ iPhone-sifferkod overlay ------------------ */
#auth-overlay { position:fixed; inset:0; background:#111; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:9999; }
#auth-overlay .padlock svg { width:60px; height:60px; stroke:#fff; stroke-width:2; fill:none; margin-bottom:24px; }
#auth-overlay .dots { display:flex; gap:14px; margin-bottom:24px; }
#auth-overlay .dots span { width:14px; height:14px; border:2px solid #fff; border-radius:50%; }
#auth-overlay .dots span.filled { background:#fff; }
#auth-overlay .keypad { display:grid; grid-template-columns:repeat(3,80px); gap:18px; justify-content:center; }
#auth-overlay .keypad button { width:80px; height:80px; border:none; border-radius:50%; background:#303030; color:#fff; font-size:1.8rem; cursor:pointer; }
#auth-overlay .keypad button:active { background:#505050; }
#auth-overlay .keypad .empty { background:transparent; cursor:default; }
#auth-error { color:#ff5252; margin-top:18px; display:none; }
</style>
</head>
<body>

<!-- ---------- iPhone-passcode overlay ---------- -->
<div id="auth-overlay">
  <div class="padlock">
    <svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
  </div>
  <div id="pass-dots" class="dots">
    <span></span><span></span><span></span><span></span><span></span><span></span>
  </div>
  <div class="keypad">
    <button data-key="1">1</button><button data-key="2">2</button><button data-key="3">3</button>
    <button data-key="4">4</button><button data-key="5">5</button><button data-key="6">6</button>
    <button data-key="7">7</button><button data-key="8">8</button><button data-key="9">9</button>
    <button class="empty"></button><button data-key="0">0</button><button id="delete">âŒ«</button>
  </div>
  <p id="auth-error">Fel kod</p>
</div>

<!-- Dark mode-toggle -->
<button id="darkModeToggle" style="position: fixed; top: 10px; right: 10px; z-index: 1200; background: #333; color: #fff; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer;">
  ðŸŒ“ Tema
</button>

<!-- Meny -->
<nav class="menu">
  <button class="tab-button active" data-tab="start"><i data-lucide="home"></i><span>Start</span></button>
  <button class="tab-button" data-tab="calendar"><i data-lucide="calendar-days"></i><span>Kalender</span></button>
  <button class="tab-button" data-tab="todo"><i data-lucide="check-square"></i><span>Att GÃ¶ra</span></button>
  <button class="tab-button" data-tab="chores"><i data-lucide="sparkles"></i><span>Sysslor</span></button>
  <button class="tab-button" data-tab="agenda"><i data-lucide="list-todo"></i><span>Agenda</span></button>
</nav>

<!-- Statusbar -->
<div class="top-status-bar">
  <div class="tsb-section tsb-left">
    <div class="forecast-others" id="forecastOthers"></div>
  </div>
  <div class="tsb-section tsb-center">
    <div class="clock-date"><span id="clock" class="big-time">--:--</span><span id="date" class="small-date">--</span></div>
  </div>
  <div class="tsb-section tsb-right">
    <div class="weather-now"><i data-lucide="sun"></i><span id="current-temp">--Â°C</span><span id="weather-desc">--</span></div>
  </div>
</div>

<!-- HuvudinnehÃ¥ll -->
<div class="container">
  <h2 id="welcome-message" style="font-family:'Playfair Display', serif; text-align:center; margin-bottom:20px; font-size:2em;"></h2>

  <!-- Startflik -->
  <div class="tab-content active" id="start">
    <div class="widget" id="today-events-widget" style="border-left:6px solid white;">
      <h2>Dagens hÃ¤ndelser</h2><div class="today-events-cards"></div>
    </div>
    <div class="widget" id="pollen-widget"><h2>Pollenprognos â€“ Eskilstuna</h2><div id="pollen-dates">GÃ¤ller: laddar datum...</div><div id="pollen-content">HÃ¤mtar pollenprognos...</div><small id="pollen-timestamp"></small></div>
    <div class="widget"><h2>Spanien</h2><p id="countdown"></p></div>
  </div>

  <!-- Kalenderflik -->
  <div class="tab-content" id="calendar">
    <div class="widget"><h2>Kalender</h2>
      <iframe class="calendar-iframe" src="https://calendar.google.com/calendar/embed?src=ad91c4e3564b7bb204982dc8609c5072d822c917edf6bb6a2398f3bb711ffa54@group.calendar.google.com&amp;src=0f3167ad3226259bfd6e201077a8989fbd70419e44fb024a9230d9e20983cbfd@group.calendar.google.com&amp;src=family03354164418688114432@group.calendar.google.com&amp;src=leiding.nilsson@gmail.com&amp;mode=MONTH&amp;showTitle=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;ctz=Europe/Stockholm"></iframe>
    </div>
  </div>

  <!-- ToDo-flik -->
  <div class="tab-content" id="todo">
    <div class="widget"><h2>Att GÃ¶ra</h2><div class="todo-card"><ul id="todo-list"></ul><input class="todo-input" id="new-task" placeholder="LÃ¤gg till ny uppgift..." type="text" /></div></div>
  </div>

  <!-- Sysslor-flik -->
  <div class="tab-content" id="chores">
    <div class="widget"><h2>Dagliga Sysslor</h2><div id="chores-container" style="display:flex; gap:20px; flex-wrap:wrap;"></div></div>
  </div>

  <!-- Agenda-flik -->
  <div class="tab-content" id="agenda">
    <div id="agenda-widget-container">
      <h2 style="text-align:center;">Familjekalender â€“ Agenda</h2>
      <div class="agenda-grid">
        <div class="agenda-column" id="emma"><h3>Emma</h3></div>
        <div class="agenda-column" id="maximilian"><h3>Maximilian</h3></div>
        <div class="agenda-column" id="familj"><h3>Familj</h3></div>
      </div>
      <div class="agenda-grid" style="margin-top:1rem;">
        <div class="agenda-column" id="dennis"><h3>Dennis</h3></div>
        <div class="agenda-column" id="milou"><h3>Milou</h3></div>
        <div class="agenda-column" id="molly"><h3>Molly</h3></div>
      </div>
      <div class="popup" id="eventPopup"><button class="popup-close" onclick="closePopup()">Ã—</button><h3 id="popupTitle"></h3><p id="popupTime"></p><p id="popupDesc"></p><p id="popupLocation"></p></div>
    </div>
  </div>
</div>

<!-- Nyhetsbanner -->
<div class="news-bar"><div class="news-content">ðŸ“° Nyhet 1 â€“ Viktig info â€’ Nyhet 2 â€“ SpÃ¤nnande hÃ¤ndelse â€’ Nyhet 3 â€“ Uppdatering â€’ Nyhet 4 â€“ Mer info â€’ Nyhet 5 â€“ Senaste nytt</div></div>

<script>
/* ---------- iPhone-sifferkod ---------- */
const correctCode="123456"; // Ã¤ndra vid behov
let passInput=[];
function updateDots(){document.querySelectorAll('#pass-dots span').forEach((s,i)=>s.classList.toggle('filled',i<passInput.length));}
function resetPass(){passInput=[];updateDots();}
function checkPass(){if(passInput.join('')===correctCode){document.getElementById('auth-overlay').style.display='none';document.body.style.overflow='';}else{const e=document.getElementById('auth-error');e.style.display='block';setTimeout(()=>{e.style.display='none';resetPass();},1200);}}
document.querySelectorAll('.keypad button[data-key]').forEach(btn=>btn.addEventListener('click',()=>{if(passInput.length<6){passInput.push(btn.dataset.key);updateDots();if(passInput.length===6)checkPass();}}));
document.getElementById('delete').addEventListener('click',()=>{passInput.pop();updateDots();});
window.addEventListener('DOMContentLoaded',()=>{document.body.style.overflow='hidden';updateDots();});

/* ---------- Fliksystem ---------- */
document.querySelectorAll('.tab-button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(tc=>tc.classList.remove('active'));
    btn.classList.add('active');
    const tab=document.getElementById(btn.dataset.tab);
    if(tab)tab.classList.add('active');
  });
});

/* ---------- Klocka & Datum ---------- */
function updateClock(){
  const now=new Date();
  document.getElementById("clock").innerText=now.toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit"});
  document.getElementById("date").innerText=now.toLocaleDateString("sv-SE",{weekday:"long",day:"numeric",month:"long"});
}
setInterval(updateClock,1000);updateClock();

/* ---------- NedrÃ¤kning (Spanien) ---------- */
const targetDate=new Date("2025-06-03T00:00:00");
function updateCountdown(){
  const diff=targetDate-new Date();
  const d=Math.floor(diff/864e5),h=Math.floor(diff/36e5)%24,m=Math.floor(diff/6e4)%60;
  document.getElementById("countdown").innerText=`${d} dagar ${h} timmar ${m} minuter kvar!`;
}
setInterval(updateCountdown,60000);updateCountdown();

/* ---------- VÃ¤der ---------- */
/* ... hela funktionen fetch7DayForecast() exakt som i ursprungskoden ... */
async function fetch7DayForecast(){
  try{
    const lon=16.7229,lat=59.0493;
    const url=`https://opendata-download-metfcst.smhi.se/api/category/pmp3g/version/2/geotype/point/lon/${lon}/lat/${lat}/data.json`;
    const res=await fetch(url);
    if(!res.ok)throw new Error(`HTTP ${res.status}`);
    const data=await res.json();
    const grouped={};
    data.timeSeries.forEach(item=>{
      const dt=new Date(item.validTime);
      const key=dt.toISOString().split('T')[0];
      (grouped[key]??=[]).push({dt,item});
    });
    const todayKey=new Date().toISOString().split('T')[0];
    const keys=Object.keys(grouped).sort();
    let today=null,others=[];
    for(const k of keys){
      if(k===todayKey){
        today=grouped[k].reduce((a,b)=>Math.abs(a.dt.getHours()-12)<Math.abs(b.dt.getHours()-12)?a:b);
      }else if(others.length<6){others.push(k);}
    }
    if(today){
      const temp=today.item.parameters.find(p=>p.name==="t").values[0];
      const sym=today.item.parameters.find(p=>p.name==="Wsymb2").values[0];
      let iconNow="sun";
      if(sym>=3&&sym<=4)iconNow="cloud-sun";
      else if(sym>=5&&sym<=6)iconNow="cloud";
      else if(sym>=7&&sym<=9)iconNow="cloud-drizzle";
      else if(sym>=10)iconNow="cloud-snow";
      document.getElementById("current-temp").innerText=`${temp}Â°C`;
      document.getElementById("weather-desc").innerText="Dagens vÃ¤der";
      document.querySelector(".weather-now i").setAttribute("data-lucide",iconNow);
    }
    const container=document.getElementById("forecastOthers");
    if(container){
      container.innerHTML="";
      others.forEach(k=>{
        const closest=grouped[k].reduce((a,b)=>Math.abs(a.dt.getHours()-12)<Math.abs(b.dt.getHours()-12)?a:b);
        const temp=closest.item.parameters.find(p=>p.name==="t").values[0];
        const sym=closest.item.parameters.find(p=>p.name==="Wsymb2").values[0];
        let iconName="sun";
        if(sym>=3&&sym<=4)iconName="cloud-sun";
        else if(sym>=5&&sym<=6)iconName="cloud";
        else if(sym>=7&&sym<=9)iconName="cloud-drizzle";
        else if(sym>=10)iconName="cloud-snow";
        const label=new Date(k).toLocaleDateString("sv-SE",{weekday:"short",day:"numeric"});
        const box=document.createElement("div");
        box.className="day";
        box.innerHTML=`<strong>${label}</strong><br><i data-lucide="${iconName}"></i><br>${temp}Â°C`;
        container.appendChild(box);
      });
    }
    if(typeof lucide!=="undefined"&&lucide.createIcons)lucide.createIcons();
  }catch(err){
    const fallback=document.getElementById("forecastOthers");
    if(fallback)fallback.innerText="Kunde inte hÃ¤mta vÃ¤dret.";
  }
}
fetch7DayForecast();setInterval(fetch7DayForecast,3600000);

/* ---------- Pollen ---------- */
/* ... exakt samma fetchPollenReport() som tidigare ... */
function fetchPollenReport(){/* ofÃ¶rÃ¤ndrad */}fetchPollenReport();

/* ---------- Nyheter ---------- */
function fetchNews(){/* ofÃ¶rÃ¤ndrad */}fetchNews();setInterval(fetchNews,3600000);

/* ---------- VÃ¤lkomstmeddelande ---------- */
function updateWelcomeMessage(){
  const h=new Date().getHours();
  let g="VÃ¤lkommen!";if(h<12)g="God morgon Leiding / Nilsson!";else if(h<18)g="God eftermiddag Leiding / Nilsson!";else g="God kvÃ¤ll Leiding / Nilsson!";
  document.getElementById("welcome-message").innerText=g;
}
updateWelcomeMessage();

/* ---------- ToDo, Sysslor, Agenda, Dagens hÃ¤ndelser ---------- */
/* ... behÃ¥ll alla funktioner exakt som i ursprungskoden ... */
</script>
</body>
</html>

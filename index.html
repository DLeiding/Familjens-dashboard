<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Familjens Dashboard ‚Äì Omdesign</title>
  <!-- Typsnitt -->
  <link href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@400;700&family=Playfair+Display&display=swap" rel="stylesheet" />

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
<style>
 /* ------------------ Globalt tema ------------------ */
    body {
      margin: 0;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(to bottom right, #f9f9f9, #e6e6e6);
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    /* ------------------ Meny ------------------ */
    .menu {
      display: flex;
      justify-content: space-around;
      width: 100%;
      background: dimgrey;
      padding: 10px 0;
      position: fixed;
      top: 0;
      left: 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      z-index: 1200;
    }
    .tab-button {
      background: none;
      border: none;
      font-weight: bold;
      padding: 10px 20px;
      border-radius: 999px;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      color: white;
    }
    .tab-button.active {
      background: cyan;
      color: #111;
    }
    .tab-button:hover {
      transform: translateY(-2px);
    }
    /* ------------------ Fasta Statusbar ------------------ */
    .top-status-bar {
      position: fixed;
      top: 60px; /* h√∂jd p√• menyn */
      left: 0;
      width: 100%;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      z-index: 1150;
    }
    /* Statusbar: V√§nster ‚Äì √∂vriga prognosdagar; Mitten ‚Äì klocka & datum; H√∂ger ‚Äì dagens v√§der */
    .tsb-left, .tsb-center, .tsb-right {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    /* Klocka & Datum (mitt) */
    .clock-date {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .big-time {
      font-size: 1.8rem;
      font-weight: 600;
    }
    .small-date {
      font-size: 0.95rem;
      color: #666;
    }
    /* Dagens v√§der (h√∂ger) */
    .weather-now {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    .weather-now i {
      font-size: 1.8rem;
      color: #333;
    }
    #current-temp {
      font-size: 1.3rem;
      font-weight: 600;
    }
    #weather-desc {
      font-size: 0.95rem;
      color: #666;
    }
    /* √ñvriga prognosdagar (v√§nster) */
    .forecast-others {
      display: flex;
      gap: 8px;
      justify-content: center;
    }
    .forecast-others .day {
      text-align: center;
      background: rgba(255, 255, 255, 0.6);
      padding: 4px;
      border-radius: 8px;
      font-size: 0.8rem;
      color: #444;
    }
    .forecast-others .day i {
      font-size: 1.2rem;
      margin: 2px 0;
    }
#auth-overlay {
  position: fixed;
  inset: 0;
  background: #111;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
#auth-overlay .padlock svg {
  width: 60px;
  height: 60px;
  stroke: #fff;
  stroke-width: 2;
  fill: none;
  margin-bottom: 24px;
}
#pass-dots {
  display: flex;
  gap: 14px;
  margin-bottom: 24px;
}
#pass-dots span {
  width: 14px;
  height: 14px;
  border: 2px solid #fff;
  border-radius: 50%;
}
#pass-dots span.filled {
  background: #fff;
}
.keypad {
  display: grid;
  grid-template-columns: repeat(3, 80px);
  gap: 18px;
  justify-content: center;
}
.keypad button {
  width: 80px;
  height: 80px;
  border: none;
  border-radius: 50%;
  background: #303030;
  color: #fff;
  font-size: 1.8rem;
  cursor: pointer;
}
.keypad button:active {
  background: #505050;
}
.keypad .empty {
  background: transparent;
  cursor: default;
}
#auth-error {
  color: #ff5252;
  margin-top: 18px;
  display: none;
}
    /* ------------------ Huvudinneh√•ll ------------------ */
    .container {
      margin-top: 130px; /* utrymme f√∂r meny + statusbar */
      background: #fff;
      backdrop-filter: blur(8px);
      padding: 30px;
      border-radius: 20px;
      width: 90%;
      max-width: 1100px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .tab-content {
      display: none;
      animation: fadeIn 0.5s forwards;
      width: 100%;
    }
    .tab-content.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* ------------------ Widgetar ------------------ */
    .widget {
      background: #fff;
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .top-widgets {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .calendar-iframe {
      width: 100%;
      height: 600px;
      border: none;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    /* ------------------ Nyhetsbanner ------------------ */
    .news-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.6);
      color: #fff;
      padding: 12px;
      font-weight: bold;
      z-index: 1100;
      white-space: nowrap;
      overflow: hidden;
    }
    .news-content {
      display: inline-block;
      padding-left: 100%;
      animation: scrollLeft 70s linear infinite;
    }
    @keyframes scrollLeft {
      from { transform: translateX(0); }
      to { transform: translateX(-100%); }
    }
    /* ------------------ ToDo ------------------ */
 /* ----- ToDo som kort ----- */
/* ------------------ ToDo som kort ------------------ */
#todo .widget { border-left: none !important; padding: 0; }
#todo .widget h2 { margin: 16px; }
.todo-card {
  background: #fdfdfd;
  border-radius: 15px;
  padding: 15px;
  margin: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  font-family: 'Poppins', sans-serif;
}
#todo-list { list-style: none; padding: 0; margin: 0; }
#todo-list li {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 12px;
  border-bottom: 1px dashed #ddd;
  transition: background 0.2s;
}
#todo-list li:last-child { border-bottom: none; }
#todo-list li:hover { background: rgba(0,0,0,0.02); }
.todo-input {
  border: none;
  border-top: 1px solid #ddd;
  padding: 12px;
  width: 100%;
  box-sizing: border-box;
  font-size: 1rem;
  border-bottom-left-radius: 15px;
  border-bottom-right-radius: 15px;
}
/* Checkbox som i Sysslor */
.todo-checkbox {
  width: 20px; height: 20px; margin-right: 12px;
  -webkit-appearance: none; appearance: none;
  border: 2px solid #ddd; border-radius: 4px;
  position: relative; transition: background 0.2s, border-color 0.2s;
}
.todo-checkbox:checked {
  background: #4caf50; border-color: #4caf50;
}
.todo-checkbox:checked::after {
  content: "‚úì"; color: #fff;
  position: absolute; top: 0; left: 3px;
  font-size: 14px; line-height: 20px;
}
/* Pop‚Äëanimation p√• text */
#todo-list li span {
  display: inline-block; transition: transform 0.2s;
}
.pop-text {
  animation: popEffect 0.5s ease-out;
}
    /* ------------------ Agenda (anv√§nder kod fr√•n din bifogade fil) ------------------ */
    .agenda-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  overflow: visible;
}
    .agenda-column {
  flex: 1;
  min-width: 22%;
  margin: 0 5px;
  padding: 15px;
  border-radius: 16px;
  backdrop-filter: blur(12px);
  transition: transform 0.3s ease;
}
    .agenda-column:hover {
      transform: translateY(-5px);
    }
    .agenda-column h3 {
      text-align: center;
      margin-bottom: 10px;
      font-family: 'Playfair Display', serif;
      font-weight: bold;
      border-bottom: 1px solid rgba(255,255,255,0.2);
      padding-bottom: 8px;
    }
    .event {
      margin-bottom: 14px;
      padding: 12px 15px;
      background: rgba(255,255,255,0.08);
      border: none;
      box-shadow: 0 1px 0 rgba(0,0,0,0.1);
      border-radius: 12px;
    }
    .popup {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: grey;
      color: cyan;
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      display: none;
      z-index: 2000;
      max-width: 90%;
    }
    .popup.active { display: block; }
    .popup .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ddd;
      padding-bottom: 8px;
      margin-bottom: 12px;
    }
    .popup .popup-body {
      max-height: 60vh;
      overflow-y: auto;
    }
    .popup .event-item {
      border-bottom: 1px dashed #ccc;
      padding: 6px 0;
      margin-bottom: 6px;
    }
    .popup-close {
      background: none;
        color: white;
      border: none;
      font-size: 1.6rem;
      cursor: pointer;
    }
/* Se till att hela raden kan animera */
#todo-list li span {
  display: inline-block;
  transition: transform 0.2s;
}

/* √Öteranv√§nd popEffect p√• texten */
.pop-text {
  animation: popEffect 0.5s ease-out;
}

    /* ------------------ Sysslor (kort) ------------------ */
    .cards-container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .card {
      background: #fdfdfd;
      border-radius: 15px;
      padding: 15px;
      width: 300px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      font-family: 'Poppins', sans-serif;
      color: #333;
    }
    .card h2 {
      text-align: center;
      font-size: 1.5rem;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid;
    }
    .card.maximilian h2 { border-color: #add8e6; color: #add8e6; }
    .card.milou h2 { border-color: #ffd1dc; color: #ffd1dc; }
    .card.molly h2 { border-color: #e6ccff; color: #e6ccff; }
    .group {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 12px;
      margin-bottom: 10px;
      overflow: hidden;
    }
    .card.maximilian .group-header { background: rgba(173,216,230,0.3); }
    .card.milou .group-header { background: rgba(255,209,220,0.3); }
    .card.molly .group-header { background: rgba(230,204,255,0.3); }
    .group-header {
      display: flex;
      align-items: center;
      padding: 10px 15px;
      cursor: pointer;
      transition: background 0.3s;
      background: #f5f5f5;
    }
    .group-header:hover { background: #e0e0e0; }
    .group-header .icon { margin-right: 8px; }
    .group-header .counter {
      margin-left: auto;
      font-size: 0.9rem;
      color: #555;
    }
    .group-content {
      display: none;
      padding: 10px 15px;
      border-top: 1px dashed #ddd;
    }
    .group-content ul { list-style: none; padding: 0; }
    .group-content li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px dashed #ddd;
      transition: transform 0.3s;
    }
    .group-content li:last-child { border-bottom: none; }
    .group-content input[type="checkbox"] {
      width: 20px;
      height: 20px;
      border: 2px solid #ddd;
      border-radius: 4px;
      margin-right: 10px;
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
      position: relative;
    }
    .group-content input[type="checkbox"]:checked {
      background: #4caf50;
      border-color: #4caf50;
    }
    .group-content input[type="checkbox"]:checked::after {
      content: "‚úì";
      color: #fff;
      position: absolute;
      top: 0;
      left: 4px;
      font-size: 14px;
    }
    .add-task {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }
    .add-task input {
      flex: 1;
      padding: 6px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 0.9rem;
    }
    .add-task button {
      padding: 6px 10px;
      background: #4caf50;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
    }
/* g√∂r ToDo‚Äëcheckboxen lik den i Sysslor */
.todo-checkbox {
  width: 20px;
  height: 20px;
  margin-right: 12px;
  cursor: pointer;
  -webkit-appearance: none;
  appearance: none;
  border: 2px solid #ddd;
  border-radius: 4px;
  position: relative;
  vertical-align: middle;
  transition: background 0.2s, border-color 0.2s;
}
.todo-checkbox:checked {
  background: #4caf50;
  border-color: #4caf50;
}
.todo-checkbox:checked::after {
  content: "‚úì";
  color: #fff;
  position: absolute;
  top: 0;
  left: 3px;
  font-size: 14px;
  line-height: 20px;
}

/* se till att uppgiftstexten kan poppas */
#todo-list li span {
  display: inline-block;
  transition: transform 0.2s;
}
/* √•teranv√§nd din popEffect p√• texten */
.pop-text {
  animation: popEffect 0.5s ease-out;
}

    /* ------------------ Effekter ------------------ */
    .pop {
      animation: popEffect 0.5s ease-out;
    }
    @keyframes popEffect {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.8; }
      100% { transform: scale(1); opacity: 1; }
    }
    /* ------------------ Dark Mode ------------------ */
    body.dark-mode {
      background: linear-gradient(to bottom right, #2c2c2c, #1c1c1c);
      color: #f0f0f0;
    }
    body.dark-mode .container,
    body.dark-mode .widget,
    body.dark-mode .card,
    body.dark-mode .group,
    body.dark-mode .group-header,
    body.dark-mode .group-content {
      background: rgba(40, 40, 40, 0.8) !important;
      color: #f0f0f0 !important;
    }
    body.dark-mode .group-header { background: rgba(60, 60, 60, 0.8) !important; }
    body.dark-mode .add-task button { background: #66bb6a; }
    /* ------------------ Media Queries (iPad) ------------------ */
    @media (min-width: 768px) and (max-width: 1024px) {
      .top-status-bar { padding: 8px 12px; }
      .big-time { font-size: 1.6rem; }
      #current-temp { font-size: 1.1rem; }
      .container { padding: 20px; }
      .widget { padding: 15px; }
      .todo-input { font-size: 1rem; }
      .tab-button { padding: 8px 16px; }
    }
/* --- √Öterst√§ll huvudevent‚Äëutseendet --- */
.agenda-column .event {
  background: transparent; /* eller vad du vill som bas */
  border-radius: 8px;
  padding: 8px 12px;
  margin-bottom: 8px;
}
/* √Ñndra font f√∂r h√§ndelserna i Agendan */
.agenda-column .event {
  font-family: 'Poppins', sans-serif;
  font-size: 0.95rem;       /* justera storlek efter behov */
  font-weight: 400;         /* eller t.ex. 600 om du vill fetare text */
  color: #333;              /* √§ndra textf√§rg om du vill */
}

/* --- F√§rgkodning av h√§ndelser per person --- */
#emma      .event { background-color: #ffeedb; }
#maximilian .event { background-color: #e3fdd9; }
#familj    .event { background-color: #ffe5e0; }
#dennis    .event { background-color: #e0f0ff; }
#milou     .event { background-color: #ffd8e6; }
#molly     .event { background-color: #f1e5ff; }

/* Justera g√§rna text‚Äë/ramf√§rg om kontrasten kr√§ver det */
#emma      .event, 
#maximilian.event,
#familj    .event,
#dennis    .event,
#milou     .event,
#molly     .event {
  border: 1px solid rgba(0,0,0,0.1);
}
/* --- Bas‚Äëwidget p√• alla kolumner --- */
.agenda-column {
  border: 1px solid rgba(0,0,0,0.1);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  background: #fdfdfd;       /* vit bakgrund f√∂r widget */
  border-radius: 16px;
  padding: 15px;
}

/* --- Specifika f√§rger & typsnitt per familjemedlem --- */
#emma {
  border-color: #FFA07A;
}
#emma h3 {
  color: #FFA07A;
  font-family: 'Poppins', sans-serif;
}
/* Streck under varje familjemedlem-rubrik */
.agenda-column h3 {
  border-bottom: 2px solid currentColor;
  padding-bottom: 4px;
  margin-bottom: 12px;
}

#maximilian {
  border-color: #e3fdd9;
}
#maximilian h3 {
  color: #e3fdd9;
  font-family: 'Poppins', sans-serif;
}

#familj {
  border-color: #ffe5e0;
}
#familj h3 {
  color: #ffe5e0;
  font-family: 'Poppins', sans-serif;
}

#dennis {
  border-color: #a0cfff;
}
#dennis h3 {
  color: #e0f0ff;
  font-family: 'Poppins', sans-serif;
}

#milou {
  border-color: #ffd1dc;
}
#milou h3 {
  color: #ffd1dc;;
  font-family: 'Poppins', sans-serif;
}

#molly {
  border-color: #e6ccff;
}
#molly h3 {
  color: #e6ccff;
  font-family: 'Poppins', sans-serif;
}
/* Popup: font f√∂r all text */
.popup {
  font-family: 'Poppins', sans-serif; /* byt till den font du vill anv√§nda */
}

/* Popup: separat font f√∂r rubriken om du vill */
.popup h3 {
  font-family: 'Poppins', sans-serif; /* eller annan font */
}
/* --- Start: Dagens h√§ndelser-widget --- */
#today-events-widget {
  background: #fff;
  border-radius: 16px;
  padding: 10px;
  margin: 20px 0;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
.today-events-cards {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
font-family: 'Poppins', sans-serif; 
}
.today-event-card {
  background: grey;
  border-radius: 12px;
  padding: 12px;
  flex: 1;
  min-width: calc(25% - 1px);
    
}
.today-event-card .header {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
}
.today-event-card .avatar {
  width: 32px; height: 32px;
  border-radius: 50%;
  background: cyan;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: #111;
  margin-right: 8px;
}
.today-event-card .name {
     font-weight: bold;
  font-weight: 800;
    color: white
}
.today-event-card .event-title {
     font-weight: bold;
  font-size: 0.99rem;
  margin-bottom: 4px;
    color: white
}
.today-event-card .event-time {
    
  font-size: 0.90rem;
  color: white;
}
/* iPad portrait */
@media only screen and (min-device-width: 768px) and (max-device-width: 1024px) and (orientation: portrait) {
  .container {
    width: 95%;
    max-width: 768px;
    padding: 15px;
  }
  .agenda-grid {
    grid-template-columns: 1fr;
    gap: 10px;
  }
  .today-events-cards,
  .cards-container {
    flex-direction: column;
  }
  .today-event-card,
  .card {
    width: 100%;
    margin-bottom: 15px;
  }
  .calendar-iframe {
    height: 400px;
  }
  .news-content {
    font-size: 0.9rem;
  }
}

/* iPad landscape */
@media only screen and (min-device-width: 768px) and (max-device-width: 1024px) and (orientation: landscape) {
  .container {
    width: 90%;
    max-width: 1024px;
    padding: 20px;
  }
  .agenda-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
  }
  .today-events-cards,
  .cards-container {
    flex-direction: row;
    flex-wrap: wrap;
    gap: 10px;
  }
  .today-event-card,
  .card {
    flex: 1 1 calc(50% - 10px);
  }
  .calendar-iframe {
    height: 500px;
  }
  /* G√∂r alla widgets full‚Äëbredd */
  .widget {
    width: 100% !important;
    margin-bottom: 15px;
  }
  /* Se till att start‚Äëwidgeten (id) ocks√• blir full‚Äëbredd */
  #today-events-widget {
    width: 100% !important;
  }

  /* Stapla tab‚Äëinneh√•llet vertikalt */
  .tab-content.active {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

}

</style>
</head>
<body>
<div id="auth-overlay">
  <div class="padlock">
    <svg viewBox="0 0 24 24">
      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
      <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
    </svg>
  </div>
  <div id="pass-dots">
    <span></span><span></span><span></span><span></span>
  </div>
  <div class="keypad">
    <button data-key="1">1</button><button data-key="2">2</button><button data-key="3">3</button>
    <button data-key="4">4</button><button data-key="5">5</button><button data-key="6">6</button>
    <button data-key="7">7</button><button data-key="8">8</button><button data-key="9">9</button>
    <button class="empty"></button><button data-key="0">0</button><button id="delete">‚å´</button>
  </div>
  <p id="auth-error">Fel kod</p>
</div>
  <!-- Dark mode-toggle -->
  <button id="darkModeToggle" style="position: fixed; top: 10px; right: 10px; z-index: 1200; background: #333; color: #fff; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer;">
    üåì Tema
  </button>
  
  <!-- Meny -->
  <nav class="menu">
    <button class="tab-button active" data-tab="start">
      <i data-lucide="home"></i>
      <span>Start</span>
    </button>
    <button class="tab-button" data-tab="calendar">
      <i data-lucide="calendar-days"></i>
      <span>Kalender</span>
    </button>
    <button class="tab-button" data-tab="todo">
      <i data-lucide="check-square"></i>
      <span>Att G√∂ra</span>
    </button>
    <button class="tab-button" data-tab="chores">
      <i data-lucide="sparkles"></i>
      <span>Sysslor</span>
    </button>
    <button class="tab-button" data-tab="agenda">
      <i data-lucide="list-todo"></i>
      <span>Agenda</span>
    </button>
  </nav>
  
  <!-- Statusbar -->
  <div class="top-status-bar">
    <div class="tsb-section tsb-left">
      <div class="forecast-others" id="forecastOthers">
        <!-- Dynamiskt fyllning med √∂vriga 6 prognosdagar via fetch7DayForecast() -->
      </div>
    </div>
    <div class="tsb-section tsb-center">
      <div class="clock-date">
        <span id="clock" class="big-time">--:--</span>
        <span id="date" class="small-date">--</span>
      </div>
    </div>
    <div class="tsb-section tsb-right">
      <div class="weather-now">
        <i data-lucide="sun"></i>
        <span id="current-temp">--¬∞C</span>
        <span id="weather-desc">--</span>
      </div>
    </div>
  </div>
  
  <!-- Huvudinneh√•ll -->
  <div class="container">
    <h2 id="welcome-message" style="font-family:'Playfair Display', serif; text-align:center; margin-bottom:20px; font-size:2em;"></h2>
      
    
    <!-- Startflik: Pollenprognos och Spanien -->
    <div class="tab-content active" id="start">
        
        <!--Dagens h√§ndelser-->
        <div class="widget" id="today-events-widget" style="border-left:6px solid white;">
    <h2>Dagens h√§ndelser</h2>
    <div class="today-events-cards">
      <!-- JS fyller kort h√§r -->
    </div>
  </div>
        
      <div class="widget" id="pollen-widget" style="border-left: 6px white;">
        <h2>Pollenprognos ‚Äì Eskilstuna</h2>
        <div id="pollen-dates" style="font-size:0.9em; margin:10px 0;">G√§ller: laddar datum...</div>
        <div id="pollen-content">H√§mtar pollenprognos fr√•n API...</div>
        <small id="pollen-timestamp" style="display:block; margin-top:10px;"></small>
        <div style="font-size:0.75em; margin-top:8px;">Uppdateras automatiskt n√§r ny prognos finns tillg√§nglig.</div>
      </div>
      <div class="widget" style="border-left: 6px white;">
        <h2>Spanien</h2>
        <p id="countdown"></p>
      </div>
    </div>
    
    <!-- Kalenderflik -->
    <div class="tab-content" id="calendar">
      <div class="widget" style="border-left: 6px solid white;">
        <h2>Kalender</h2>
        <iframe class="calendar-iframe" src="https://calendar.google.com/calendar/embed?src=ad91c4e3564b7bb204982dc8609c5072d822c917edf6bb6a2398f3bb711ffa54@group.calendar.google.com&amp;src=0f3167ad3226259bfd6e201077a8989fbd70419e44fb024a9230d9e20983cbfd@group.calendar.google.com&amp;src=family03354164418688114432@group.calendar.google.com&amp;src=leiding.nilsson@gmail.com&amp;mode=MONTH&amp;showTitle=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;ctz=Europe/Stockholm"></iframe>
      </div>
    </div>
    
    <!-- Att G√∂ra-flik -->
<div class="tab-content" id="todo">
  <div class="widget">
    <h2>Att G√∂ra</h2>
    <div class="todo-card">
      <ul id="todo-list"></ul>
      <input class="todo-input" id="new-task" placeholder="L√§gg till ny uppgift..." type="text" />
    </div>
  </div>
</div>

    
    <!-- Sysslor-flik -->
    <div class="tab-content" id="chores">
      <div class="widget" style="border-left: 6px solid white;">
        <h2>Dagliga Sysslor</h2>
        <div id="chores-container" style="display:flex; justify-content:center; gap:20px; flex-wrap:wrap;"></div>
      </div>
    </div>
    
    <!-- Agenda-flik (anv√§nder den fungerande agendakoden fr√•n din bifogade fil) -->
    <div class="tab-content" id="agenda">
      <div id="agenda-widget-container">
        <h2 style="text-align:center;">Familjekalender ‚Äì Agenda </h2>
        <div class="agenda-grid">
          <div class="agenda-column fade-in" id="emma" style="background-color:white;"><h3>Emma</h3></div>
          <div class="agenda-column fade-in" id="maximilian" style="background-color:white;"><h3>Maximilian</h3></div>
          <div class="agenda-column fade-in" id="familj" style="background-color:white;"><h3>Familj</h3></div>
        </div>
        <div class="agenda-grid" style="margin-top:1rem;">
          <div class="agenda-column fade-in" id="dennis" style="background-color:white;"><h3>Dennis</h3></div>
          <div class="agenda-column fade-in" id="milou" style="background-color:white;"><h3>Milou</h3></div>
          <div class="agenda-column fade-in" id="molly" style="background-color:white;"><h3>Molly</h3></div>
        </div>
        <div class="popup" id="eventPopup">
          <button class="popup-close" onclick="closePopup()">√ó</button>
          <h3 id="popupTitle"></h3>
          <p id="popupTime"></p>
          <p id="popupDesc"></p>
          <p id="popupLocation"></p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Nyhetsbanner -->
  <div class="news-bar">
    <div class="news-content">üì∞ Nyhet 1 ‚Äì Viktig info ‚Äí Nyhet 2 ‚Äì Sp√§nnande h√§ndelse ‚Äí Nyhet 3 ‚Äì Uppdatering ‚Äí Nyhet 4 ‚Äì Mer info ‚Äí Nyhet 5 ‚Äì Senaste nytt</div>
  </div>
  
  <!-- ------------------ Scriptblock ------------------ -->
<script>
  const correctCode = "1234";
  let passInput = [];

  function updateDots() {
    document.querySelectorAll('#pass-dots span').forEach((s, i) =>
      s.classList.toggle('filled', i < passInput.length)
    );
  }

  function resetPass() {
    passInput = [];
    updateDots();
  }

  function checkPass() {
    if (passInput.join('') === correctCode) {
      document.getElementById('auth-overlay').style.display = 'none';
      document.body.style.overflow = '';
    } else {
      const e = document.getElementById('auth-error');
      e.style.display = 'block';
      setTimeout(() => {
        e.style.display = 'none';
        resetPass();
      }, 1200);
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    // D√∂lj scroll under overlay
    document.body.style.overflow = 'hidden';
    updateDots();

    // Sifferknappar
    document.querySelectorAll('.keypad button[data-key]').forEach(btn =>
      btn.addEventListener('click', () => {
        if (passInput.length < 4) {
          passInput.push(btn.dataset.key);
          updateDots();
          if (passInput.length === 4) checkPass(); // √§ndra fr√•n 4 till X hur l√•ng kod du vill ha OBS ring chefen om du inte f√•r till DOTS cirklar. 070 492 79 38
        }
      })
    );

    // Radera-knapp
    document.getElementById('delete').addEventListener('click', () => {
      passInput.pop();
      updateDots();
    });
  });
</script>
<script>
    // Fliksystem
    document.querySelectorAll('.tab-button').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
        btn.classList.add('active');
        const tab = document.getElementById(btn.dataset.tab);
        if (tab) tab.classList.add('active');
      });
    });
  
    // Klocka & Datum i statusbar
    function updateClock() {
      const now = new Date();
      document.getElementById("clock").innerText = now.toLocaleTimeString("sv-SE", { hour:"2-digit", minute:"2-digit" });
      document.getElementById("date").innerText = now.toLocaleDateString("sv-SE", { weekday:"long", day:"numeric", month:"long" });
    }
    setInterval(updateClock, 1000);
    updateClock();
  
    // Nedr√§kning (Spanien-widgeten)
    const targetDate = new Date("2025-06-03T00:00:00");
    function updateCountdown() {
      const diff = targetDate - new Date();
      const d = Math.floor(diff / 864e5),
            h = Math.floor(diff / 36e5) % 24,
            m = Math.floor(diff / 6e4) % 60;
      document.getElementById("countdown").innerText = `${d} dagar ${h} timmar ${m} minuter kvar!`;
    }
    setInterval(updateCountdown, 60000);
    updateCountdown();
  
    // V√§der ‚Äì 7-dagarsprognos f√∂r statusbar (dagens data i h√∂gra delen, √∂vriga dagar i v√§nstra)
async function fetch7DayForecast() {
  try {
    const lon = 16.7229, lat = 59.0493;
    const url = `https://opendata-download-metfcst.smhi.se/api/category/pmp3g/version/2/geotype/point/lon/${lon}/lat/${lat}/data.json`;

    const res = await fetch(url);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();

    const grouped = {};
    data.timeSeries.forEach(item => {
      const dt = new Date(item.validTime);
      const key = dt.toISOString().split('T')[0];
      (grouped[key] ??= []).push({ dt, item });
    });

    const todayKey = new Date().toISOString().split('T')[0];
    const keys = Object.keys(grouped).sort();

    let today = null, others = [];
    for (const k of keys) {
      if (k === todayKey) {
        today = grouped[k].reduce((a, b) =>
          Math.abs(a.dt.getHours() - 12) < Math.abs(b.dt.getHours() - 12) ? a : b
        );
      } else if (others.length < 6) {
        others.push(k);
      }
    }

    if (today) {
      const temp = today.item.parameters.find(p => p.name === "t").values[0];
      const sym  = today.item.parameters.find(p => p.name === "Wsymb2").values[0];
      let iconNow = "sun";
      if (sym >= 3 && sym <= 4) iconNow = "cloud-sun";
      else if (sym >= 5 && sym <= 6) iconNow = "cloud";
      else if (sym >= 7 && sym <= 9) iconNow = "cloud-drizzle";
      else if (sym >= 10) iconNow = "cloud-snow";

      const tempEl = document.getElementById("current-temp");
      const descEl = document.getElementById("weather-desc");
      const iconEl = document.querySelector(".weather-now i");

      if (tempEl) tempEl.innerText = `${temp}¬∞C`;
      if (descEl) descEl.innerText = "Dagens v√§der";
      if (iconEl) iconEl.setAttribute("data-lucide", iconNow);
    }

    const container = document.getElementById("forecastOthers");
    if (container) {
      container.innerHTML = "";
      others.forEach(k => {
          if (typeof lucide !== "undefined" && lucide.createIcons) lucide.createIcons();

  const closest = grouped[k].reduce((a, b) =>
    Math.abs(a.dt.getHours() - 12) < Math.abs(b.dt.getHours() - 12) ? a : b
  );
  const temp = closest.item.parameters.find(p => p.name === "t").values[0];
  const sym  = closest.item.parameters.find(p => p.name === "Wsymb2").values[0];

  let iconName = "sun";
  if (sym >= 3 && sym <= 4)      iconName = "cloud-sun";
  else if (sym >= 5 && sym <= 6) iconName = "cloud";
  else if (sym >= 7 && sym <= 9) iconName = "cloud-drizzle";
  else if (sym >= 10)            iconName = "cloud-snow";

  const label = new Date(k).toLocaleDateString("sv-SE", { weekday: "short", day: "numeric" });
  const box = document.createElement("div");
  box.className = "day";
  box.innerHTML = `
    <strong>${label}</strong><br>
    <i data-lucide="${iconName}"></i><br>
    ${temp}¬∞C
  `;
  container.appendChild(box);
});

    }

    if (typeof lucide !== "undefined" && lucide.createIcons) lucide.createIcons();
  } catch (err) {
    const fallback = document.getElementById("forecastOthers") || document.getElementById("weatherForecast");
    if (fallback) fallback.innerText = "Kunde inte h√§mta v√§dret.";
    console.error(err);
  }
}

fetch7DayForecast();
setInterval(fetch7DayForecast, 60 * 60 * 1000);
      
    // Pollenprognos ‚Äì Funktionen enligt din bifogade fil (Ny2.html)
    function fetchPollenReport() {
      const content = document.getElementById("pollen-content");
      const timestamp = document.getElementById("pollen-timestamp");
      const dateBox = document.getElementById("pollen-dates");
      const pollenMap = {
        "2a2a2a2a-2a2a-4a2a-aa2a-2a313a323236": { name: "Al", icon: "üå≤" },
        "2a2a2a2a-2a2a-4a2a-aa2a-2a313a323533": { name: "Mal√∂rtsambrosia", icon: "üß™" },
        "2a2a2a2a-2a2a-4a2a-aa2a-2a313a323530": { name: "Gr√•bo", icon: "ü™¥" },
        "2a2a2a2a-2a2a-4a2a-aa2a-2a313a323332": { name: "Bj√∂rk", icon: "üå≥" },
        "2a2a2a2a-2a2a-4a2a-aa2a-2a313a323233": { name: "Hassel", icon: "üçÇ" },
        "2a2a2a2a-2a2a-4a2a-aa2a-2a313a323335": { name: "Bok", icon: "üåø" },
        "2a2a2a2a-2a2a-4a2a-aa2a-2a313a323433": { name: "Gr√§s", icon: "üçÉ" },
        "2a2a2a2a-2a2a-4a2a-aa2a-2a313a323337": { name: "Ek", icon: "üå∞" },
        "2a2a2a2a-2a2a-4a2a-aa2a-2a313a323330": { name: "S√§lg och viden", icon: "üêù" },
        "2a2a2a2a-2a2a-4a2a-aa2a-2a313a323331": { name: "Alm", icon: "üåæ" }
      };
      const levelMap = {
        0: { label: "Inga halter", percent: 0, color: "#ccc" },
        1: { label: "L√•ga", percent: 25, color: "#7ed957" },
        2: { label: "M√•ttliga", percent: 60, color: "#ffa500" },
        3: { label: "H√∂ga", percent: 85, color: "#ff4500" },
        4: { label: "Mycket h√∂ga", percent: 100, color: "#8b0000" }
      };
      fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent("https://api.pollenrapporten.se/v1/forecasts?region_id=2a2a2a2a-2a2a-4a2a-aa2a-2a2a303a3134&current=true"))
        .then(res => res.json())
        .then(data => {
          if (!data.items || data.items.length === 0 || !data.items[0].levelSeries || !data.items[0].startDate || !data.items[0].endDate) {
            content.innerHTML = "Ingen prognos hittades.";
            return;
          }
          let html = "";
          let shown = {};
          data.items[0].levelSeries.forEach(entry => {
            const pollen = pollenMap[entry.pollenId];
            const level = levelMap[entry.level];
            if (!pollen || !level || entry.level === 0 || shown[entry.pollenId]) return;
            shown[entry.pollenId] = true;
            html += `
            <div class="pollen-meter" style="display:inline-block;text-align:center;margin:10px;width:90px;">
              <svg viewBox="0 0 36 36" style="width:70px;height:70px;transform:rotate(-90deg);">
                <path d="M18 2 a 16 16 0 1 1 0 32 a 16 16 0 1 1 0 -32"
                  fill="none" stroke="#eee" stroke-width="3"/>
                <path d="M18 2 a 16 16 0 1 1 0 32 a 16 16 0 1 1 0 -32"
                  fill="none" stroke="${level.color}" stroke-width="3" stroke-linecap="round" stroke-dasharray="${level.percent},100"/>
              </svg>
              <div class="pollen-icon" style="font-size:1.4em;">${pollen.icon}</div>
              <div class="pollen-label" style="font-weight:bold;">${pollen.name}</div>
              <div class="pollen-level" style="font-size:0.8em;color:#ccc;">${level.label}</div>
            </div>`;
          });
          content.innerHTML = html || "Ingen information tillg√§nglig.";
          const startDate = new Date(data.items[0].startDate);
          const endDate = new Date(data.items[0].endDate);
          const formatter = new Intl.DateTimeFormat("sv-SE", { day: "numeric", month: "long" });
          if(dateBox) { dateBox.innerText = "G√§ller: " + formatter.format(startDate) + " ‚Äì " + formatter.format(endDate); }
          const now = new Date();
          document.getElementById("pollen-timestamp").innerText = "Senast uppdaterad: " + now.toLocaleString("sv-SE");
        })
        .catch(error => {
          content.innerHTML = "Fel vid h√§mtning av pollenprognos.";
          console.error(error);
        });
    }
    fetchPollenReport();
  
    // Nyheter ‚Äì med 50 sekunders cykel
    function fetchNews() {
      fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent("https://www.svt.se/nyheter/lokalt/sormland/rss.xml")}`)
        .then(r => r.json())
        .then(data => {
          const nc = document.querySelector(".news-content");
          let newsText = "";
          data.items.slice(0, 5).forEach(item => { newsText += `üì∞ ${item.title} ‚Äí `; });
          fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent("https://www.ekuriren.se/rss/lokalt")}`)
            .then(r => r.json())
            .then(data => {
              data.items.slice(0, 5).forEach(item => { newsText += `[E-Kuriren] ${item.title} ‚Äí `; });
              nc.innerText = newsText.slice(0, -3);
            });
        })
        .catch(() => {
          document.querySelector(".news-content").innerText = "Kunde inte ladda nyheter";
        });
    }
    fetchNews();
    setInterval(fetchNews, 3600000);
  
    // V√§lkomstmeddelande
    function updateWelcomeMessage() {
      const hour = new Date().getHours();
      let greet = "V√§lkommen!";
      if(hour < 12) greet = "God morgon Leiding / Nilsson!";
      else if(hour < 18) greet = "God eftermiddag Leiding / Nilsson!";
      else greet = "God kv√§ll Leiding / Nilsson!";
      document.getElementById("welcome-message").innerText = greet;
    }
    updateWelcomeMessage();
  
    // ToDo ‚Äì Spara & ladda
const todoList = document.getElementById("todo-list"),
      newTaskInput = document.getElementById("new-task");

function saveTodos() {
  localStorage.setItem("todos", JSON.stringify(
    [...todoList.children].map(li => ({
      text: li.querySelector('span').innerText,
      done: li.querySelector('.todo-checkbox').checked
    }))
  ));
}

function loadTodos() {
 todoList.innerHTML = "";

  JSON.parse(localStorage.getItem("todos"))?.forEach(item => {
    const li = document.createElement("li");
    li.innerHTML = `
      <input type="checkbox" class="todo-checkbox" ${item.done ? "checked" : ""}>
      <span>${item.text}</span>
      <span class="remove-btn">‚ùå</span>
    `;
    todoList.appendChild(li);
  });
}
// L√§gg till ny uppgift
newTaskInput.addEventListener("keypress", e => {
  if (e.key === "Enter" && newTaskInput.value.trim() !== "") {
    const li = document.createElement("li");
    li.innerHTML = `
      <input type="checkbox" class="todo-checkbox">
      <span>${newTaskInput.value}</span>
      <span class="remove-btn">‚ùå</span>
    `;
    todoList.appendChild(li);
    newTaskInput.value = "";
    saveTodos();
  }
});

// Hantera checkbox‚Äëtoggle & pop‚Äëanimation
todoList.addEventListener("change", e => {
  if (e.target.classList.contains("todo-checkbox")) {
    e.target.classList.add("pop");
    const text = e.target.nextElementSibling;
    text.classList.add("pop-text");
    setTimeout(() => {
      e.target.classList.remove("pop");
      text.classList.remove("pop-text");
    }, 500);
    saveTodos();
  }
});

// Ta bort uppgift
todoList.addEventListener("click", e => {
  if (e.target.classList.contains("remove-btn")) {
    e.target.closest("li").remove();
    saveTodos();
  }
});

    loadTodos();
  
    // Sysslor ‚Äì Om inte redan finns sysslor i "chores-container" s√• skapas tre kort (f√∂r Maximilian, Milou, Molly)
    function populateChores() {
      const container = document.getElementById('chores-container');
      if(container.children.length > 0) return; // Om redan finns, g√∂r inget
      const children = [
        {name: 'Maximilian', color: 'lightblue'},
        {name: 'Milou', color: 'lightpink'},
        {name: 'Molly', color: 'plum'}
      ];
      const periods = ['morgon', 'f√∂rmiddag', 'eftermiddag', 'kv√§ll', '√∂vrigt'];
      children.forEach(c => {
        const card = document.createElement('div');
        card.className = 'card ' + c.name.toLowerCase();
        card.innerHTML = `<h2>${c.name}</h2>`;
        periods.forEach(period => {
          const group = document.createElement('div');
          group.className = 'group';
          group.setAttribute('data-child', c.name.toLowerCase());
          group.setAttribute('data-group', period);
          // V√§lj ikon baserat p√• period
          let iconName = 'check-square';
          if (period === 'morgon') iconName = 'sunrise';
          else if (period === 'f√∂rmiddag') iconName = 'coffee';
          else if (period === 'eftermiddag') iconName = 'sun';
          else if (period === 'kv√§ll') iconName = 'moon';
          group.innerHTML = `
            <div class="group-header">
              <span class="icon"><i data-lucide="${iconName}"></i></span>
              <span class="group-title">${period.charAt(0).toUpperCase() + period.slice(1)}</span>
              <span class="counter">(0/0)</span>
            </div>
            <div class="group-content">
              <ul class="task-list"></ul>
              <div class="add-task">
                <input type="text" placeholder="Ny syssla...">
                <button>Add</button>
              </div>
            </div>
          `;
          card.appendChild(group);
        });
        container.appendChild(card);
      });
    }
    populateChores();
  
    // Sysslor ‚Äì Collapse, hantering och spara
    document.querySelectorAll('.card .group-header').forEach(header => {
      header.addEventListener('click', () => {
        const content = header.nextElementSibling;
        content.style.display = (content.style.display === 'block') ? 'none' : 'block';
        updateGroupCounter(header.parentElement);
      });
    });
    function updateGroupCounter(groupElem) {
      const tasks = groupElem.querySelectorAll('.task-list li');
      const done = groupElem.querySelectorAll('.task-list li input[type="checkbox"]:checked');
      const counterEl = groupElem.querySelector('.group-header .counter');
      counterEl.innerText = `(${done.length}/${tasks.length})`;
    }
    function addTask(groupElem, text) {
      const ul = groupElem.querySelector('.task-list');
      const li = document.createElement('li');
      li.innerHTML = `<input type="checkbox"> <span>${text}</span> <button class="remove-btn">‚úï</button>`;
      const checkbox = li.querySelector("input[type='checkbox']");
      checkbox.addEventListener('change', () => {
        li.classList.toggle("done", checkbox.checked);
        li.classList.add('pop');
        setTimeout(() => { li.classList.remove('pop'); }, 500);
        updateGroupCounter(groupElem);
        saveChores();
      });
      li.querySelector(".remove-btn").addEventListener('click', () => {
        li.remove();
        updateGroupCounter(groupElem);
        saveChores();
      });
      ul.appendChild(li);
      updateGroupCounter(groupElem);
      saveChores();
    }
    document.querySelectorAll('.card .add-task').forEach(div => {
      const input = div.querySelector('input');
      const button = div.querySelector('button');
      const groupElem = div.closest('.group');
      button.addEventListener('click', () => {
        const text = input.value.trim();
        if(text !== ""){
          addTask(groupElem, text);
          input.value = "";
        }
      });
      input.addEventListener('keypress', (e) => {
        if(e.key === 'Enter') { button.click(); }
      });
    });
    const CHORES_KEY = "choresData";
    function initializeDefaultChores() {
      // Endast initiera standarddata om inget finns sparat
      if (!localStorage.getItem(CHORES_KEY)) {
        const defaultChores = {
          maximilian: {
            morgon: [
              { text: "Borsta t√§nder", done: false },
              { text: "√Ñta frukost", done: false },
              { text: "Kl√§der", done: false }
            ],
            f√∂rmiddag: [ { text: "√Ñta mellanm√•l", done: false } ],
            eftermiddag: [ { text: "L√§xor", done: false } ],
            kv√§ll: [ { text: "Duscha/bada", done: false } ],
            √∂vrigt: [
              { text: "St√§da sitt rum", done: false },
              { text: "Plocka ur diskmaskinen", done: false }
            ]
          },
          milou: {
            morgon: [
              { text: "Borsta t√§nder", done: false },
              { text: "Borsta h√•r", done: false },
              { text: "Kl√§der", done: false }
            ],
            f√∂rmiddag: [ { text: "√Ñta mellanm√•l", done: false } ],
            eftermiddag: [ { text: "Leka", done: false } ],
            kv√§ll: [ { text: "L√§sa en saga", done: false } ],
            √∂vrigt: [ { text: "Rensa leksaker", done: false } ]
          },
          molly: {
            morgon: [
              { text: "Borsta t√§nder", done: false },
              { text: "Borsta h√•r", done: false },
              { text: "Kl√§der", done: false }
            ],
            f√∂rmiddag: [ { text: "Frukost", done: false } ],
            eftermiddag: [ { text: "Rita", done: false } ],
            kv√§ll: [ { text: "Lyssna p√• musik", done: false } ],
            √∂vrigt: [ { text: "Rensa leksaker", done: false } ]
          }
        };
        localStorage.setItem(CHORES_KEY, JSON.stringify(defaultChores));
      }
    }
    function saveChores() {
      const data = {};
      document.querySelectorAll('.card .group').forEach(group => {
        const child = group.getAttribute('data-child');
        const groupName = group.getAttribute('data-group');
        if (!data[child]) { data[child] = {}; }
        const tasks = [];
        group.querySelectorAll('.task-list li').forEach(li => {
          tasks.push({
            text: li.querySelector('span').innerText,
            done: li.querySelector("input[type='checkbox']").checked
          });
        });
        data[child][groupName] = tasks;
      });
      localStorage.setItem(CHORES_KEY, JSON.stringify(data));
    }
    function loadChores() {
      const data = JSON.parse(localStorage.getItem(CHORES_KEY)) || {};
      document.querySelectorAll('.card .group').forEach(group => {
        const child = group.getAttribute('data-child');
        const groupName = group.getAttribute('data-group');
        const ul = group.querySelector('.task-list');
        ul.innerHTML = "";
        if (data[child] && data[child][groupName]) {
          data[child][groupName].forEach(task => {
            const li = document.createElement('li');
            li.innerHTML = `<input type="checkbox" ${task.done ? "checked" : ""}> <span>${task.text}</span> <button class="remove-btn">‚úï</button>`;
            const checkbox = li.querySelector("input[type='checkbox']");
            checkbox.addEventListener('change', () => {
              li.classList.toggle("done", checkbox.checked);
              li.classList.add('pop');
              setTimeout(() => { li.classList.remove('pop'); }, 500);
              updateGroupCounter(group);
              saveChores();
            });
            li.querySelector(".remove-btn").addEventListener('click', () => {
              li.remove();
              updateGroupCounter(group);
              saveChores();
            });
            ul.appendChild(li);
            updateGroupCounter(group);
          });
        }
      });
    }
    initializeDefaultChores();
    loadChores();
    function resetChoresAtMidnight() {
      const now = new Date();
      const millisTillMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 1) - now;
      setTimeout(() => {
        localStorage.removeItem(CHORES_KEY);
        document.querySelectorAll('.card .group').forEach(group => {
          group.querySelector('.task-list').innerHTML = "";
          updateGroupCounter(group);
        });
      }, millisTillMidnight);
    }
    resetChoresAtMidnight();
  
    // Agenda ‚Äì H√§mta h√§ndelser fr√•n Google Kalender
    const calApiKey = "AIzaSyBXJ9puCyi1PmtuelhHKf9tuUVW0nxXipo";
    const calendarIds = {
      emma: "ad91c4e3564b7bb204982dc8609c5072d822c917edf6bb6a2398f3bb711ffa54@group.calendar.google.com",
      maximilian: "0f3167ad3226259bfd6e201077a8989fbd70419e44fb024a9230d9e20983cbfd@group.calendar.google.com",
      familj: "family03354164418688114432@group.calendar.google.com",
      dennis: "leiding.nilsson@gmail.com",
      milou: "6edb28b15afd62fd8c51edc9482a49d06b8c58c096a0e2c3ca76bd64034e8e56@group.calendar.google.com",
      molly: "a306a7a3268a9ed9a607dae0aeccb20e4a5c9ab4341c202fd0bfb923b4d06e26@group.calendar.google.com"
    };
    async function fetchEvents(calendarId, maxResults = 5) {
      const now = new Date().toISOString();
      const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendarId)}/events?key=${calApiKey}&timeMin=${now}&maxResults=${maxResults}&singleEvents=true&orderBy=startTime`;
      const res = await fetch(url);
      const data = await res.json();
      return data.items || [];
    }
    async function loadAgenda() {
      for (const [member, calId] of Object.entries(calendarIds)) {
        const container = document.getElementById(member);
        if (!container) continue;
        const events = await fetchEvents(calId, 5);
        events.forEach(event => {
          const start = event.start.dateTime || event.start.date;
          const startDate = new Date(start);
          const dateStr = startDate.toLocaleDateString("sv-SE", { weekday: 'short', day: 'numeric', month: 'short' });
          const timeStr = event.start.dateTime ? startDate.toLocaleTimeString("sv-SE", { hour: '2-digit', minute: '2-digit' }) : "Heldag";
          const div = document.createElement("div");
          div.classList.add("event");
          div.innerHTML = `<strong>${dateStr}</strong>: ${event.summary || '(Namnl√∂s)'}`;
          if (new Date(start).toDateString() === new Date().toDateString()) {
            div.classList.add('today-event');
          }
          div.addEventListener("click", () => openPopup(event.summary, `${dateStr} ${timeStr}`, event.description, event.location));
          container.appendChild(div);
        });
      }
    }
  
    // Popup f√∂r Agenda-h√§ndelser ‚Äì st√§ngs med krysset samt vid klick utanf√∂r
    function openPopup(title, time, desc, location) {
      document.getElementById("popupTitle").textContent = title;
      document.getElementById("popupTime").textContent = time;
      document.getElementById("popupDesc").textContent = desc || "Ingen beskrivning";
      document.getElementById("popupLocation").textContent = location || "";
      document.getElementById("eventPopup").classList.add("active");
    }
    function closePopup() {
      document.getElementById("eventPopup").classList.remove("active");
    }
    document.addEventListener("click", function(e) {
      const popup = document.getElementById("eventPopup");
      if (popup.classList.contains("active") && !popup.contains(e.target) && e.target.closest(".agenda-column") == null) {
        closePopup();
      }
    });
  
    // Fade-in vid flikbyte
    document.querySelectorAll('.tab-button').forEach(btn => {
      btn.addEventListener('click', () => {
        const tab = document.getElementById(btn.dataset.tab);
        if (tab) {
          const fadeIns = tab.querySelectorAll('.fade-in');
          fadeIns.forEach((el, i) => {
            el.style.animation = 'none';
            el.offsetHeight;
            el.style.animation = `fadeInUp 0.6s ease forwards`;
            el.style.animationDelay = `${i * 0.15}s`;
          });
        }
      });
    });
  
    // Initiera Lucide-ikoner
    lucide.createIcons();
     // --- H√§mta dagens eller n√§sta h√§ndelse per medlem ---
async function fetchTodayEvents() {
  const container = document.querySelector('#today-events-widget .today-events-cards');
  container.innerHTML = '';
  const todayKey = new Date().toISOString().split('T')[0];
  for (const [member, calId] of Object.entries(calendarIds)) {
    const events = await fetchEvents(calId, 10);
    const nextEv = events.find(e => {
      const d = new Date(e.start.dateTime || e.start.date);
      return d.toISOString().split('T')[0] >= todayKey;
    }) || { summary: '(Ingen h√§ndelse)', start: {} };
    const title = nextEv.summary;
    const start = nextEv.start.dateTime || nextEv.start.date || '';
    const dObj = new Date(start);
    const dateStr = start
      ? dObj.toLocaleDateString('sv-SE',{day:'numeric',month:'short'})
      : '';
    const timeStr = nextEv.start.dateTime
      ? dObj.toLocaleTimeString('sv-SE',{hour:'2-digit',minute:'2-digit'})
      : 'Heldag';
    const card = document.createElement('div');
    card.className = 'today-event-card';
    const avatar = member.slice(0,2).toUpperCase();
    card.innerHTML = `
      <div class="header">
        <div class="avatar">${avatar}</div>
        <div class="name">${member.charAt(0).toUpperCase()+member.slice(1)}</div>
      </div>
      <div class="event-title">${title}</div>
      <div class="event-time">${dateStr} ${timeStr}</div>
    `;
    container.appendChild(card);
  }
}

// ‚Äî √§ndra din DOMContentLoaded‚Äëlistener till:
window.addEventListener('DOMContentLoaded', () => {
  loadAgenda();        // befintlig agenda‚Äëfunktion
  fetchTodayEvents();  // v√•r nya widget
}); 
  </script>
</body>
</html>
